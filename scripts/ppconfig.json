{"name":"ddeaabcbfb","url":"https://www.u8mm0j2j4.com/","showName":"豆包截图","appid":"com.ddeaabcbfb.pakeplus","icon":"","iconPath":"C:\\Users\\YZH\\AppData\\Roaming\\com.pakeplus.pacbao\\3pzbg4p8fge.png","iconRound":true,"state":true,"single":true,"injectJq":true,"tauriApi":false,"devbug":false,"version":"2.2.1","preview":"desktop","platform":["1-1","2-2"],"width":300,"height":400,"desc":"","jsFile":[],"filterCss":"","customJs":"var scheduledTime = null;\nvar isTaskRunning = false;\nvar taskStep1Attempts = 0;\nvar maxTaskAttempts = 20;\nvar failCheckCount = 0;\nvar maxFailCheckCount = 3000;\nvar attempts = 0;\nvar maxAttempts = 20;\nvar loginAttempts = 0;\nvar maxLoginAttempts = 50;\nvar isLoggedIn = false;\n\nfunction log(msg, type) {\n    try {\n        var d = new Date();\n        var timeStr = d.toLocaleTimeString();\n        var ms = d.getMilliseconds();\n        var output = '[AutoLogin ' + timeStr + '.' + ms + '] ' + msg;\n        \n        var style = 'color: #333;';\n        if (type === 'info') {\n            style = 'color: #409EFF; font-weight: bold;';\n        } else if (type === 'success') {\n            style = 'color: #67C23A; font-weight: bold;';\n        } else if (type === 'error') {\n            style = 'color: #F56C6C; font-weight: bold;';\n        } else if (type === 'warn') {\n            style = 'color: #E6A23C;';\n        }\n        \n        if (typeof window.console !== 'undefined' && typeof window.console.log === 'function') {\n            console.log('%c' + output, style);\n        }\n    } catch(e) {}\n}\n\nfunction randomDelay(min, max) {\n    return Math.floor(Math.random() * (max - min + 1)) + min;\n}\n\nfunction simulateClick(element, callback) {\n    var rect = element.getBoundingClientRect();\n    var x = rect.left + rect.width / 2 + randomDelay(-5, 5);\n    var y = rect.top + rect.height / 2 + randomDelay(-5, 5);\n    \n    if (element.scrollIntoView) {\n        element.scrollIntoView({ behavior: 'instant', block: 'center' });\n    }\n    \n    element.dispatchEvent(new MouseEvent('mouseover', { bubbles: true, clientX: x, clientY: y }));\n    element.dispatchEvent(new MouseEvent('mousedown', { bubbles: true, clientX: x, clientY: y }));\n    element.dispatchEvent(new MouseEvent('mouseup', { bubbles: true, clientX: x, clientY: y }));\n    element.click();\n    \n    if (callback) {\n        setTimeout(callback, 50);\n    }\n}\n\nfunction triggerInputEvent(element) {\n    var events = ['input', 'change', 'blur'];\n    events.forEach(function(eventType) {\n        var event = new Event(eventType, { bubbles: true });\n        element.dispatchEvent(event);\n    });\n}\n\nfunction executeTask() {\n    if (isTaskRunning) {\n        return;\n    }\n    isTaskRunning = true;\n    failCheckCount = 0;\n    \n    log('开始执行任务', 'info');\n    taskStep1Attempts = 0;\n    executeTaskStep1();\n}\n\nfunction executeTaskStep1() {\n    taskStep1Attempts++;\n    log('尝试查找领取任务按钮, attempt: ' + taskStep1Attempts, 'warn');\n    \n    var taskBtn = null;\n    \n    var taskBtnSpan = document.evaluate(\n        '//span[contains(text(),\"领取今日任务\")]',\n        document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null\n    ).singleNodeValue;\n    taskBtn = taskBtnSpan ? taskBtnSpan.parentElement : null;\n    \n    if (taskBtn) {\n        log('找到领取今日任务按钮', 'success');\n        simulateClick(taskBtn, function() {\n            log('已点击领取今日任务按钮', 'success');\n            isTaskRunning = false;\n            checkConfirmAndExecute();\n        });\n    } else if (taskStep1Attempts < maxTaskAttempts) {\n        setTimeout(executeTaskStep1, 300);\n    } else {\n        log('未找到领取今日任务按钮，任务结束', 'error');\n        isTaskRunning = false;\n    }\n}\n\nfunction checkConfirmAndExecute() {\n    var confirmBtnSpan = document.evaluate(\n        '//span[contains(text(),\"确认并拉取任务\")]',\n        document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null\n    ).singleNodeValue;\n    var confirmBtn = confirmBtnSpan ? confirmBtnSpan.parentElement : null;\n    \n    if (confirmBtn) {\n        log('找到确认按钮', 'success');\n        simulateClick(confirmBtn, function() {\n            log('已点击确认按钮，等待检查失败信息', 'success');\n            setTimeout(checkTaskFailure, 300);\n        });\n    } else {\n        log('未找到确认按钮，300ms后重试', 'warn');\n        setTimeout(checkConfirmAndExecute, 300);\n    }\n}\n\nfunction checkTaskFailure() {\n    if (failCheckCount >= maxFailCheckCount) {\n        log('失败检测已达到最大次数，任务结束', 'error');\n        return;\n    }\n    failCheckCount++;\n    \n    var errorSpan = document.evaluate(\n        '//span[contains(text(),\"响应码异常:3,参数异常\")]',\n        document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null\n    ).singleNodeValue;\n    \n    if (!errorSpan) {\n        var allSpans = document.querySelectorAll('span');\n        for (var k = 0; k < allSpans.length; k++) {\n            if (allSpans[k].textContent.indexOf('响应码异常') !== -1) {\n                errorSpan = allSpans[k];\n                break;\n            }\n        }\n    }\n    \n    if (errorSpan) {\n        log('检测到参数异常错误，点击取消任务按钮', 'error');\n        \n        var cancelBtnSpan = document.evaluate(\n            '//span[contains(text(),\"取消任务｜返回首页\")]',\n            document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null\n        ).singleNodeValue;\n        \n        if (cancelBtnSpan) {\n            var cancelBtn = cancelBtnSpan.parentElement;\n            if (cancelBtn && cancelBtn.tagName === 'BUTTON') {\n                simulateClick(cancelBtn, function() {\n                    log('已点击取消任务按钮，等待确认按钮出现', 'warn');\n                    \n                    var checkConfirmBtn = setInterval(function() {\n                        var confirmBtn = document.querySelector('button.el-button.el-button--default.el-button--small.el-button--primary');\n                        if (confirmBtn) {\n                            clearInterval(checkConfirmBtn);\n                            log('找到确认按钮，点击', 'success');\n                            simulateClick(confirmBtn, function() {\n                                log('已点击确认按钮，重新执行任务', 'success');\n                                failCheckCount = 0;\n                                executeTaskStep1();\n                            });\n                        }\n                    }, 500);\n                });\n                return;\n            }\n        }\n        \n        location.reload();\n        return;\n    }\n    \n    var failSpan = document.evaluate(\n        '//span[text()=\"获取任务失败 ｜ 等待重新获取任务\"]',\n        document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null\n    ).singleNodeValue;\n    \n    if (failSpan) {\n        log('检测到失败信息', 'warn');\n        var failBtn = document.querySelector('#app > section.el-container > main.el-main > div.businessTaskPage > button.el-button:nth-of-type(2)');\n        if (failBtn) {\n            log('点击重新获取按钮', 'error');\n            simulateClick(failBtn, function() {\n                log('已点击重新获取', 'error');\n            });\n        }\n    }\n    setTimeout(checkTaskFailure, 200);\n}\n\nfunction checkLogoutAndPrompt() {\n    loginAttempts++;\n    \n    var logoutSpan = document.evaluate(\n        '//span[text()=\"退出\"]',\n        document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null\n    ).singleNodeValue;\n    \n    log('检查退出按钮, attempt: ' + loginAttempts + ', found: ' + (logoutSpan !== null), 'warn');\n    \n    if (logoutSpan) {\n        log('找到退出按钮，弹出设置时间', 'success');\n        var defaultTime = '09:59:58';\n        createCustomPrompt(defaultTime, function(userTime) {\n            scheduledTime = userTime;\n            log('已设置运行时间: ' + scheduledTime, 'info');\n            waitForScheduledTime();\n        }, function() {\n            executeTask();\n        });\n    } else if (loginAttempts < maxLoginAttempts) {\n        setTimeout(checkLogoutAndPrompt, 500);\n    }\n}\n\nfunction autoLogin() {\n    if (isLoggedIn) {\n        return;\n    }\n    \n    attempts++;\n    \n    var inputs = document.querySelectorAll('input');\n    var usernameInput = null;\n    var passwordInput = null;\n    \n    for (var i = 0; i < inputs.length; i++) {\n        var input = inputs[i];\n        if (input.type === 'text' && input.placeholder === '输入用户名称') {\n            usernameInput = input;\n        }\n        if (input.type === 'password' && input.placeholder === '请输入密码') {\n            passwordInput = input;\n        }\n    }\n    \n    var buttons = document.querySelectorAll('button');\n    var loginButton = null;\n    \n    for (var j = 0; j < buttons.length; j++) {\n        var btn = buttons[j];\n        if (btn.textContent === '登录' && btn.type === 'button') {\n            loginButton = btn;\n            break;\n        }\n    }\n    \n    if (usernameInput && passwordInput && loginButton) {\n        log('找到登录表单，开始自动登录', 'info');\n        simulateClick(usernameInput, function() {\n            usernameInput.focus();\n            \n            var username = 'AADdy11-069';\n            var charIndex = 0;\n            \n            function typeUsername() {\n                if (charIndex < username.length) {\n                    usernameInput.value = username.substring(0, charIndex + 1);\n                    triggerInputEvent(usernameInput);\n                    charIndex++;\n                    setTimeout(typeUsername, randomDelay(50, 150));\n                } else {\n                    log('用户名输入完成', 'success');\n                    setTimeout(function() {\n                        simulateClick(passwordInput, function() {\n                            passwordInput.focus();\n                            \n                            var password = 'f3QhMXmSL3vR';\n                            var pwdIndex = 0;\n                            \n                            function typePassword() {\n                                if (pwdIndex < password.length) {\n                                    passwordInput.value = password.substring(0, pwdIndex + 1);\n                                    triggerInputEvent(passwordInput);\n                                    pwdIndex++;\n                                    setTimeout(typePassword, randomDelay(50, 150));\n                                } else {\n                                    log('密码输入完成', 'success');\n                                    log('请手动点击登录按钮', 'info');\n                                    isLoggedIn = true;\n                                    setTimeout(checkLogoutAndPrompt, 1000);\n                                }\n                            }\n                            \n                            typePassword();\n                        });\n                    }, randomDelay(200, 500));\n                }\n            }\n            \n            typeUsername();\n        });\n    } else {\n        log('未找到登录表单', 'error');\n    }\n}\n\nfunction createCustomPrompt(defaultTime, callback, runNowCallback) {\n    log('创建自定义弹窗', 'info');\n    \n    var overlay = document.createElement('div');\n    overlay.id = 'auto-login-overlay';\n    overlay.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:99999;display:flex;justify-content:center;align-items:center;';\n    \n    var box = document.createElement('div');\n    box.style.cssText = 'background:#fff;padding:30px;border-radius:10px;min-width:300px;box-shadow:0 4px 20px rgba(0,0,0,0.3);';\n    \n    var title = document.createElement('div');\n    title.style.cssText = 'font-size:18px;font-weight:bold;margin-bottom:20px;color:#333;';\n    title.textContent = '设置脚本运行时间';\n    \n    var input = document.createElement('input');\n    input.type = 'text';\n    input.placeholder = 'HH:mm:ss';\n    input.value = defaultTime;\n    input.id = 'auto-login-time-input';\n    input.style.cssText = 'width:100%;padding:10px;font-size:16px;margin-bottom:20px;border:1px solid #ddd;border-radius:5px;';\n    \n    var btnContainer = document.createElement('div');\n    btnContainer.style.cssText = 'display:flex;gap:10px;';\n    \n    var btnRunNow = document.createElement('button');\n    btnRunNow.textContent = '立即运行';\n    btnRunNow.style.cssText = 'flex:1;padding:12px;font-size:16px;background:#67C23A;color:#fff;border:none;border-radius:5px;cursor:pointer;';\n    \n    var btnConfirm = document.createElement('button');\n    btnConfirm.textContent = '确定';\n    btnConfirm.style.cssText = 'flex:1;padding:12px;font-size:16px;background:#409EFF;color:#fff;border:none;border-radius:5px;cursor:pointer;';\n    \n    btnRunNow.onclick = function() {\n        overlay.remove();\n        if (runNowCallback) {\n            runNowCallback();\n        }\n    };\n    \n    btnConfirm.onclick = function() {\n        var time = input.value || defaultTime;\n        var timeRegex = /^(\\d{2}):(\\d{2}):(\\d{2})$/;\n        if (!timeRegex.test(time)) {\n            log('时间格式错误，请使用 HH:mm:ss 格式', 'error');\n            return;\n        }\n        overlay.remove();\n        if (callback) {\n            callback(time);\n        }\n    };\n    \n    btnContainer.appendChild(btnRunNow);\n    btnContainer.appendChild(btnConfirm);\n    \n    box.appendChild(title);\n    box.appendChild(input);\n    box.appendChild(btnContainer);\n    overlay.appendChild(box);\n    document.body.appendChild(overlay);\n    \n    log('自定义弹窗已创建', 'success');\n}\n\nfunction waitForScheduledTime() {\n    if (!scheduledTime) {\n        log('未设置运行时间', 'error');\n        return;\n    }\n    \n    var now = new Date();\n    var currentTime = now.toTimeString().substring(0, 8);\n    \n    log('当前时间: ' + currentTime + ', 目标时间: ' + scheduledTime, 'warn');\n    \n    if (currentTime >= scheduledTime) {\n        log('到达目标时间，开始执行任务', 'success');\n        executeTask();\n    } else {\n        setTimeout(waitForScheduledTime, 1000);\n    }\n}\n\nlog('脚本启动', 'info');\n\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', autoLogin);\n} else {\n    autoLogin();\n}\n","isHtml":false,"htmlPath":"","htmlFiles":[],"prefix":"","pcRepo":"PakePlus-v2.1.8","iosRepo":"PakePlus-iOS-v2.1.8","androidRepo":"PakePlus-Android-v2.1.8","more":{"windows":{"label":"","title":"豆包截图","url":"https://www.u8mm0j2j4.com/","userAgent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36","width":300,"height":400,"theme":null,"resizable":true,"fullscreen":false,"maximized":false,"minWidth":400,"minHeight":300,"maxWidth":1920,"maxHeight":1080,"decorations":true,"transparent":false,"titleBarStyle":"Visible","visible":true,"focus":true,"closable":true,"minimizable":true,"maximizable":true,"alwaysOnTop":false,"alwaysOnBottom":false,"center":false,"shadow":true,"skipTaskbar":false,"tabbingIdentifier":null,"parent":null,"dragDropEnabled":true,"browserExtensionsEnabled":false,"devtools":true,"contentProtected":false,"hiddenTitle":false,"incognito":false,"proxyUrl":null,"useHttpsScheme":false,"zoomHotkeysEnabled":false,"acceptFirstMouse":false,"create":false,"backgroundColor":null,"backgroundThrottling":null,"javascriptDisabled":false}},"phone":{"fullScreen":false,"safeArea":{"top":0,"bottom":0,"left":0,"right":0},"header":{"show":false,"title":"","backgroundColor":"","color":"","fontSize":16,"fontWeight":"bold","loading":false,"toolBar":false,"toolBarBackgroundColor":"","toolBarColor":"","toolBarFontSize":16,"toolBarFontWeight":"bold"},"siderMenu":{"show":false,"width":0,"backgroundColor":"","color":"","fontSize":16,"fontWeight":"bold","title":"","titleColor":"","titleFontSize":16,"titleFontWeight":"bold"},"tabBar":{"show":false,"backgroundColor":"","color":"","activeColor":"","fontSize":16,"fontWeight":"bold","tabBarItem":[]},"webview":{"userAgent":"","javaScriptEnabled":true,"domStorageEnabled":true,"allowFileAccess":true,"loadWithOverviewMode":true,"setSupportZoom":true,"clearCache":true}},"ios":{"name":"ddeaabcbfb","showName":"豆包截图","version":"2.2.1","webUrl":"https://www.u8mm0j2j4.com/","id":"com.ddeaabcbfb.pakeplus.ios","icon":"./app-icon.png","desc":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","pubBody":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","isHtml":false,"debug":false,"safeArea":"all"},"android":{"name":"ddeaabcbfb","showName":"豆包截图","version":"2.2.1","webUrl":"https://www.u8mm0j2j4.com/","id":"com.ddeaabcbfb.pakeplus.android","icon":"./app-icon.png","input":"./app-icon.png","output":"./res","rounded":true,"copyTo":"./app/src/main/res","androidResDir":"./app/src/main/res","desc":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","pubBody":"Package for personal use only, please do not use for commercial purposes（打包仅限个人使用，请勿传播或商业用途）","isHtml":false,"debug":false,"safeArea":"all"},"desktop":{"name":"ddeaabcbfb","showName":"豆包截图","version":"2.2.1","id":"com.ddeaabcbfb.pakeplus.desktop","desc":"打包仅限个人使用，请勿传播或商业用途，否则后果自负","webUrl":"https://www.u8mm0j2j4.com/","iconPath":"../app-icon.png","inputPath":"../app-icon.png","tempPath":"./processed-image.png","icnsPath":"../src-tauri/icons/icon.icns","pubBody":"打包仅限个人使用，请勿传播或商业用途，否则后果自负","isHtml":false,"single":false,"state":false,"injectJq":false,"tauriApi":false,"buildMethod":"cloud","debug":true}}